# name of the workflow, what it is doing (optional)
name: Tests

# events that trigger the workflow (required)
on:
  push:
    # pushes to the following branches
    branches:
      - master
  pull_request:
    # pull request where master is target
    branches:
      - master

env:
  # Directory of PyPi package to be tested
  PACKAGE_DIR: boxmot
  # Minimum acceptable test coverage
  # Increase as you add more tests to increase coverage
  COVERAGE_FAIL_UNDER: 29

jobs:
  test-tests:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    - run: 
        python -m pip install --upgrade pip setuptools wheel
        pip install -e . pytest pytest-cov --extra-index-url https://download.pytorch.org/whl/cpu

    - name: Pytest tests  # after tracking options as this does not download models
      shell: bash  # for Windows compatibility
      run: |
        pytest --cov=$PACKAGE_DIR --cov-report=html -v tests
        coverage report --fail-under=$COVERAGE_FAIL_UNDER